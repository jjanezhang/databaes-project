{% extends "base.html" %}

{% block content %}

<br>
{% if current_user.is_authenticated %}
<h3> 
  <div style="color: black; text-align: left; margin-bottom: 20px; 
    text-transform: capitalize; font-weight: bolder; font-style: bold; ">
    Welcome back, {{current_user.firstname}} 
  </div> 
</h3>
{% endif %}

{% include "products.html" %}
<br>
{% if current_user.is_authenticated %}
<h3>
  Your Recent Purchases:
</h3>

<table id="table"
  data-toggle="table"
  data-filter-control="true"
  data-show-search-clear-button="true"
  data-sortable="true"
  classes="table-sm"
  data-pagination="true"
  class="table-responsive"
  data-search="true"
>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Order ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Qty Purchased</th>
      <th scope="col">Total Price</th>
      <th scope="col">Fullfillment Status</th>
      <th scope="col">Time Purchased</th>
    </tr>
  </thead>
  <tbody>
    {% for purchase in purchase_history %}
      <tr>
        <th data-field="oid" data-filter-control="input" data-sortable="true" scope="row">{{ purchase.oid }}</th>
        <td data-field="product_name" data-filter-control="input" data-sortable="true"><a href="products/{{purchase.product_name}}"> {{ purchase.product_name }} </a></td>
        <td data-field="quantity" data-filter-control="input" data-sortable="true">{{ purchase.quantity }}</td>
        <td data-field="price" data-filter-control="input" data-sortable="true">${{ purchase.price }}</td>
        <td data-field="fulfilled" data-filter-control="input" data-sortable="true">{{ purchase.fulfilled }}</td>
        <td data-field="time_purchased" data-filter-control="input" data-sortable="true">{{ purchase.time_purchased }}</td>        
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your purchase history</p>
{% endif %}

{% endblock %}
